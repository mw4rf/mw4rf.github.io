<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Statut d'un RAID logiciel par e-mail</title>
  <meta name="description" content="La meilleure solution pour assurer la sécurité de ses données numériques reste à ce jour l'utilisation de plusieurs disques en RAID 1 "miroir". Lorsque deux ...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://127.0.0.1:4000//mac/2008/08/31/statut-raid-mail.html">
  <link rel="alternate" type="application/atom+xml" title="Valhalla.fr" href="http://127.0.0.1:4000//feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Valhalla.fr</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about.html">A propos</a>
          
        
          
        
          
        
          
          <a class="page-link" href="/cours-java/index.html">Cours Java</a>
          
        
          
          <a class="page-link" href="/articles-essentiels/index.html">Articles essentiels</a>
          
        
          
          <a class="page-link" href="/references/index.html">Références</a>
          
        
          
          <a class="page-link" href="/outils/index.html">Outils</a>
          
        
          
          <a class="page-link" href="/top-10/index.html">Top 10</a>
          
        
          
          <a class="page-link" href="/liste/index.html">Liste des articles</a>
          
        
          
          <a class="page-link" href="/archives/index.html">Archives de la revue</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Statut d'un RAID logiciel par e-mail</h1>
    <p class="post-meta">Aug 31, 2008 • {"display_name"=>"GF", "login"=>"gflorimond", "email"=>"gf@valhalla.fr", "url"=>"http://www.valhalla.fr"}</p>
  </header>

  <article class="post-content">
    <p>La meilleure solution pour assurer la sécurité de ses données numériques reste à ce jour l'utilisation de plusieurs disques en RAID 1 "miroir". Lorsque deux disques durs sont montés en RAID 1, chaque fichier copié sur un disque l'est aussi automatiquement sur l'autre. La copie est transparente pour l'utilisateur, qui ne voit qu'un seul volume logiciel de la taille d'un seul disque. Si l'un des deux disques devient inutilisable, les données peuvent toujours être récupérées depuis le second disque. Un tel montage est efficace contre les pannes matérielles qui affectent habituellement les disques durs. Mais encore faut-il vérifier régulièrement l'état du Raid. En effet, si un disque tombe en panne, l'autre disque prendra immédiatement le relai sans que l'utilisateur s'en aperçoive. Celui-ci pourra encore croire en l'intégrité du Raid, alors qu'un seul disque reste fonctionnel. Il est donc nécessaire d'obtenir des informations sur l'état du Raid, par exemple par e-mail. </p>
<p><a id="more"></a><a id="more-140"></a></p>
<p>La première chose à faire est de créer un RAID logiciel. Il faut bien entendu deux disques durs de taille identique (internes ou externes ; mieux vaut internes).</p>
<p>L'utilitaire de disques de Mac OS X, se trouvant dans <i>Applications/Utilitaires/</i> permet de créer des Raid 1 logiciels. Une fois les deux disques reconnus par l'utilitaire de disque, il suffit de créer un <u>Ensemble RAID en miroir</u>. Attention, les disques seront alors formatés...</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713505/" title="Raid1 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3287/2812713505_07ae545e56.jpg" width="500" height="412" alt="Raid1" /></a></p>
<p>Une fois le raid monté, il est bien sûr possible de revenir dans l'utilitaire de disques pour en vérifier l'intégrité. Mais il est aussi facile d'oublier de le faire...</p>
<p>Nous utiliserons donc une commande du terminal, qui informe sur l'état du raid, et nous enverrons le résultat de cette commande par e-mail grâce à un script automator lancé de manière récurrente par iCal.</p>
<p>La commande de terminal en question est <b>diskutil checkraid</b>.</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713503/" title="raid2 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3064/2812713503_ee3dbb048a_o.jpg" width="585" height="297" alt="raid2" /></a></p>
<p>La seule chose vraiment importance dans tout ce texte, c'est la colonne "Status" qui, pour les deux disques, indique "Online". Voilà ce qu'il faut vérifier périodiquement : que tous les disques sont "online", c'est-à-dire en bon état de marche.</p>
<p>L'idée est donc ici d'obtenir le résultat de la dommande diskutil checkraid pour l'insérer dans un e-mail qui sera envoyé de manière récurrente.</p>
<p>Le script que j'utilise fonctionne ainsi :</p>
<ol>
<li /><u>Créer un fichier texte</u> à un endroit précis du disque (p. ex. ~/Documents/). Cocher la case <i>Remplacer les fichiers présents</i> pour éviter que le script échoue si le fichier existe déjà à cet emplacement. Donner au fichier un nom évocateur, p. ex. CHECKRAID.txt
<li /><u>Exécuter un script Shell</u> : diskutil checkraid
<li />(Optionnel) <u>Afficher les résultats</u> : cette action ne sert qu'à voir, dans Automator, ce que renvoie le script Shell précédent. Elle peut être supprimée sans incidence sur la suite.
<li /><u>Définir le contenu du document TextEdit</u> : le message renvoyé par le script Shell sera inséré dans le fichier texte créé à la première étape. Option : <i>Remplacement</i> pour être sûr que, s'il y a déjà du texte dans le fichier, celui-ci soit effacé et remplacé par le résultat du script Shell (en principe, si la case Remplacer... est cochée à l'étape 1, ceci est superflu).
<li /><u>Nouveau message mail</u>, en indiquant bien entendu le destinataire (votre e-mail), le compte de l'expéditeur (il faut avoir paramétré Apple Mail auparavant) et l'objet. On peut insérer des variables dans l'objet, par exemple la date et l'heure d'exécution de notre script. Le contenu du fichier texte sera inséré dans le corps de l'e-mail.
<li /><u>Envoyer les messages de la boîte d'envoi</u> pour que l'e-mail soit envoyé immédiatement.
<li />(Optionnel) <u>Obtenir les éléments du Finder indiqués</u>, choisir le fichier créé à l'étape 1, puis <u>Placer des éléments du Finder dans la corbeille</u> pour faire le ménage après l'exécution du script.
</ol>
<p>Voici le résultat dans Automator :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812702007/" title="Image 5 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3037/2812702007_95286ce199_o.png" width="712" height="621" alt="Image 5" /></a><br />
<a href="http://www.flickr.com/photos/valhallafr/2812768863/" title="raid6 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3198/2812768863_3ff4b8b5e6_o.jpg" width="707" height="652" alt="raid6" /></a></p>
<p>Reste ensuite à enregistrer notre script. Dans Automator, on ira dans le menu Fichier &gt; Enregistrer sous. On fera cela deux fois, en choisissant dans le menu déroulant <i>Processus</i> et <i>Application</i>. Cela donnera deux fichiers :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812702015/" title="Image 4 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3146/2812702015_00a5eb5d1b_o.png" width="277" height="86" alt="Image 4" /></a></p>
<p>Le premier est l'application, que nous utiliserons par la suite. Le second est le fichier que l'on ouvre dans Automator pour modifier le script.</p>
<p>Reste à lancer <b>iCal</b> et à créer un nouvel événement récurrent :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713495/" title="raid3 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3087/2812713495_dc473cca7d_o.jpg" width="297" height="410" alt="raid3" /></a></p>
<p>On choisira l'action <i>Ouvrir le fichier</i> et on sélectionnera le fichier d'application créé à l'étape précédente. On définira ensuite la périodicité de cet événement.</p>
<p>NB : le lancement de l'application par iCal étant la manifestation d'une alarme, programmée X minutes avant le début de l'événement, il faudra faire débuter l'événement à H+X minutes pour que l'e-mail soit envoyé à l'heure H voulue. Sur l'image précédente, événement à 12h15, rappel 15 minutes avant le début, e-mail envoyé à 12h00.</p>
<p>C'est tout !</p>
<p>Vous pouvez télécharger le script pour Automator (Leopard) et le modifier à votre guise : <a href="http://www.valhalla.fr/wp-content/uploads/2008/08/checkraid.zip">CheckRaid</a></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Valhalla.fr</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Valhalla.fr</li>
          <li><a href="mailto:your-email@domain.com">your-email@domain.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mw4rf">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">mw4rf</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Ad Absurdum</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
