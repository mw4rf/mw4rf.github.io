<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>De l'utilité de réparer les autorisations sous Mac OS X</title>
  <meta name="description" content="Mac OS X est un système très robuste, basé sur un coeur (kernel) dérivé des systèmes BSD: Darwin. C'est même certainement -au sens véritable du terme- le sys...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://127.0.0.1:4000//mac/2005/09/27/de-lutilite-de-reparer-les-autorisations-sous-mac-os-x.html">
  <link rel="alternate" type="application/atom+xml" title="Valhalla.fr" href="http://127.0.0.1:4000//feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Valhalla.fr</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about.html">A propos</a>
          
        
          
        
          
        
          
          <a class="page-link" href="/archives/index.html">Archives de la revue</a>
          
        
          
          <a class="page-link" href="/cours-java/index.html">Cours Java</a>
          
        
          
          <a class="page-link" href="/articles-essentiels/index.html">Articles essentiels</a>
          
        
          
          <a class="page-link" href="/themes/index.html">Thèmes</a>
          
        
          
          <a class="page-link" href="/references/index.html">Références</a>
          
        
          
          <a class="page-link" href="/top-10/index.html">Top 10</a>
          
        
          
          <a class="page-link" href="/outils/index.html">Outils</a>
          
        
          
          <a class="page-link" href="/liens/index.html">Liens</a>
          
        
          
          <a class="page-link" href="/liste/index.html">Liste des articles</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">De l'utilité de réparer les autorisations sous Mac OS X</h1>
    <p class="post-meta">Sep 27, 2005 • {"display_name"=>"GF", "login"=>"gflorimond", "email"=>"gf@valhalla.fr", "url"=>"http://www.valhalla.fr"}</p>
  </header>

  <article class="post-content">
    <p>
Mac OS X est un système très robuste, basé sur un coeur (kernel) dérivé des systèmes BSD: Darwin. C'est même certainement -au sens véritable du terme- le système le plus robuste et le plus sécurisé accessible au grand public. Néanmoins puisqu'il est possible, comme sous tout système d'exploitation qui se respecte, d'installer de nombreuses applications qui modifient plus ou moins la configuration logicielle système, Mac OS X n'est pas totalement à l'abris des dysfonctionnements. Pour corriger ces dysfonctionnements et restaurer l'état du système, il existe de nombreux moyens qui tendent tous plus ou moins à la même chose: revenir à l'état d'avant la modification entraînant le dysfonctionnement. Un de ces moyens s'appelle la <em>réparation des autorisations</em>.</p>
<p>
Dans tous les sites internet d'aide à l'utilisation du Mac, sur tous les forums et dans toute la presse Mac, le premier conseil que l'on donne lorsqu'un comportement anormal du système ou d'une application est détecté est de réparer les autorisations. C'est une aberration. Un mauvais conseil qui s'est bien trop vite répandu, véhiculé par des gens qui ne savent définitivement pas de quoi ils parlent. Dans 99% des cas, réparer les autorisations ne résoudra pas le problème.</p>
<p>
Je vous propose de découvrir dans cet article les raisons pour lesquelles la réparation des autorisations n'est pas un remède miracle. Je vous propose également de comprendre dans quels cas la réparation des autorisations est efficiente, et dans quels cas elle ne l'est pas. Je vais pour cela m'appuyer sur la trame de fond d'un excellent article de blog écrit en mai 2005 par Rosyna de l'équipe Unsanity.</p>
<h3>Le pavé dans la marre</h3>
<p>
Comme l'explique Apple <strong>(*)</strong> dans un <a href="http://docs.info.apple.com/article.html?artnum=25751" target="_blank">article de sa Knowledge Base</a> dédié à l'utilitaire de disque, <u>la réparation des autorisations ne s'applique pas aux logiciels tierce-partie n'ayant pas été installés grâce à l'assistant d'installation Apple</u> (<i>Installer.app</i>). Elle ne s'applique donc pas aux logiciels installés par glisser-déposer (<i>drag&amp;drop</i>) à partir d'une image disque, et aux logiciels installés à partir d'un assistant d'installation non-Apple (par exemple, ceux d'Allume et de MindVision). La réparation des autorisations ne fonctionne donc que pour les logiciels installés grâce au logiciel d'installation Apple, dès lors que leur éditeur a prévu la création d'un reçu d'installation (<i>Receipt</i>) contenant les informations correctes relatives aux autorisations des fichiers copiés sur le disque lors de l'installation -- ce qui n'est pas forcément le cas. De la même manière, <u>la réparation automatique des autorisations n'a pas d'effet sur les fichiers personnels que l'utilisateur a créé ou importé sur son Mac</u>.</p>
<blockquote><p>
<strong>(*)</strong> Mise à jour : la page de la Knowledge Base Apple a été modifiée depuis la rédaction originale de cet article et explique désormais --à l'heure de Snow Leopard-- la situation de manière très claire : <i>« Utilitaire de disque vérifie-t-il les autorisations de tous les fichiers ? Non. Les fichiers qui ne sont pas installés par un paquet d’installation Apple ne sont pas répertoriés dans un reçu. Ils ne sont donc pas vérifiés »</i>. Cela est en parfait accord avec ce qui est expliqué ici.
</p></blockquote>
<p>
La réparation des autorisations ne règlera pas votre problème dans la majorité des cas. Elle n'empêchera pas non plus des problèmes de survenir dans le futur. Elle ne sert à rien en tant qu'opération planifiée de maintenance. Vous pouvez quand même écouter les conseils prodigués sur les forums par des gens qui s'y connaissent plus ou moins, mais qui n'ont rien compris aux autorisations, et les réparer: cela ne nuira pas à votre système, et pour cause puisque cela ne produira sans doute aucun effet.</p>
<p>
Je ne peux pas résister à l'envie de vous traduire une discussion entre Homer et Lisa Simpson dans le célère dessin animé du même nom, que Rosyna retranscrit dans son article:</p>
<ul style="list-style-type: none;">
<li /> <strong>Homer:</strong> Pas un seul ours en vue. La patrouille anti-ours doit vraiment bien fonctionner !
<li /> <strong>Lisa:</strong> C'est un bon raisonnement, papa.
<li /> <strong>Homer:</strong> Merci, ma chérie.
<li /> <strong>Lisa:</strong> En suivant le même raisonnement, je pourrais dire que cette pierre tient les tigres à l'écart.
<li /> <strong>Homer:</strong> Ah ! Et comment ça marche ?
<li /> <strong>Lisa:</strong> Ca ne marche pas.
<li /> <strong>Homer:</strong> Hu-hu...
<li /> <strong>Lisa:</strong> Ce n'est qu'une bête pierre.
<li /> <strong>Homer:</strong> Hu-hu...
<li /> <strong>Lisa:</strong> Mais il n'y a aucun tigre à l'horizon, n'est-ce pas ?
<li /> <em>[Homer y réfléchit et sort quelques billets de sa poche]</em>
<li /> <strong>Homer:</strong> Lisa, je veux acheter ta pierre.
<li /> <em>[Lisa commence par refuser, puis accepte l'échange]</em>
</ul>
<h3>Ce que la réparation des autorisations fait et ne fait pas</h3>
<p>
La réparation des autorisations parcourt tous les paquetages (<em>packages</em>) dans le répertoire <em>/Library/Receipts/</em>. Un <em>reçu</em> de package est créé seulement quand un logiciel est installé avec l'assistant d'installation d'Apple (<em>Installer.app</em>). Cet assistant crée d'abord un package temporaire avec tous les fichiers du package d'origine. Lors de l'installation, un package contenant la liste de tous les fichiers installés à partir du package d'origine est créé. Les packages du répertoire /Library/Receipts/ ne contiennent donc que des références vers les fichiers, ils ne contiennent pas directement les fichiers.</p>
<p>
Il est possible d'afficher le contenu du package depuis le Terminal en utilisant la commande <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man8/lsbom.8.html" taget="_blank">lsbom</a> de cette manière: <span class="Code">lsbom /Library/Receipts/MacOSX10.4.pkg/Contents/Archive.bom</span>.</p>
<p>
Ainsi, l'utilitaire de disque parcourt le répertoire /Library/Receipts/ du <a href="http://docs.info.apple.com/article.html?artnum=25751" target="_blank">volume cible</a>. Cela implique que, pour que les autorisations soient réparées, le volume cible <u>doit</u> avoir un répertoire /Library/Receipts/. Les conséquences sont multiples. La première et la plus évidente est qu'<u>il ne peut y avoir de réparation des autorisations sur un volume sur lequel Mac OS X n'est pas installé</u>. Adieu donc les disque durs annexes (aussi bien internes qu'externes) qui ne servent pas au boot du système. La deuxième implication est beaucoup plus vicieuse. En effet, Installer.app ne permet pas dans la majorité des cas de choisir le répertoire de destination de l'installation. On peut donc en conclure que, sauf si vous avez utilisé un des Installer.app qui permettent de choisir le répertoire de destination (ce qui n'est généralement pas le cas des Installer.app distribués par Apple), la réparation des autorisations n'aura strictement aucun effet sur les fichiers de votre répertoire utilisateur home. La troisième conséquence est qu'aucun des fichiers générés lors de l'utilisation de Mac OS X (les fichiers temporaires, cache, de swap, etc.) n'est modifié. Cette règle peut ainsi être généralisée: <u><em>aucun fichier non créé par Installer.app ne sera modifié par la réparation des autorisations</em></u>.</p>
<h3>Un peu d'Histoire</h3>
<p>
Apple a introduit le <a href="http://docs.info.apple.com/article.html?artnum=106900" target="_blank">Repair Privileges Utility</a> pour le système 10.1.5. Et la raison était simple: à cette époque les Mac pouvaient encore booter sur OS 9. Or, OS 9 n'a cure des permissions (ce n'est pas un Unix). Un utilisateur pouvait donc corrompre un installation de OS X depuis OS 9, en manipulant des fichiers système, ou pire encore en utilisant un utilitaire tierce-partie comme Norton. De nos jours, le seul système présent sur la machine est OS X. Il n'y a plus de OS 9, ni même de Classic. Le problème ne se pose donc plus.</p>
<p>
Une autre des raisons qui motivèrent Apple pour inclure la réparation des autorisations dans l'Utilitaire de Disque est la présence sur notre plateforme d'assistants d'installation tierce-partie comme ceux d'<a href="http://www.allume.com/mac/" target="_blank">Allume</a> ou de <a href="http://www.mindvision.com/" target="_blank">MindVision</a>. Ces deux programmes ont longtemps été relativement dangereux pour un système sous OS X. Ils sont à l'heure actuelle très stables, et ne m'ont personnellement jamais causé de problème d'autorisations (et à Rosyna non plus d'ailleurs).</p>
<p>
La troisième raison est la faiblesse des utilisateurs eux-mêmes. Il est courant dans la communauté Mac de dire que le seul virus identifié sous OS X se situe entre la chaise et le clavier... Il est vrai que l'utilisateur peut manipuler des fichiers système et altérer leurs autorisations. Dans ce cas, la réparation est utile.</p>
<h3>Dans un cas, la réparation est nécessaire</h3>
<p>
Les autorisations ne changement pas toutes seules. Pour qu'elles changent, <u>il faut que</u> <em>quelque chose</em> les change. Pour cette raison, réparer les autorisations de temps en temps, en guise d'opération de maintenance, est <u>totalement inutile</u>.</p>
<p>
Il y a cependant un cas dans lequel la réparation des autorisations est absolument nécessaire -et résoud les problèmes. Quand vous sauvegardez votre système vers un disque externe via <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/ditto.1.html" target="_blank">ditto</a> ou <a href="http://www.bombich.com/software/ccc.html" target="_blank">Carbon Copy Cloner</a>, en ignorant les autorisations du volume source. En réparant les autorisations dans cette situation, on permet au disque de redevenir bootable, mais on ne touche toujours pas aux fichiers indépendants du systèmes ou appartenant à l'utilisateur, ce qui peut laisser ouverts d'énormes trous de sécurité.</p>
<h3>C'est trop bête...</h3>
<p>
Il n'est pas rare de voir sur les forums des gens conseiller à d'autres de réparer les autorisations avant et après une mise à jour du système par l'utilitaire de mise à jour du menu Pomme. C'est complètement stupide. L'utilitaire de mise à jour s'exécute comme <em>root</em> et n'a que faire des autorisations. L'utilisateur <em>root</em> est <u>dieu</u> sur les systèmes Unix: il peut tout faire, il n'est soumis à aucune contrainte. Bonnes autorisations, mauvaises autorisations, pas d'autorisations: c'est pour lui du pareil au même. La réparation des autorisations ne modifie en rien les chances de réussir l'installation. Pour cette raison, il est inutile de réparer les autorisations avant l'installation d'une mise à jour. Et c'est également inutile après la mise à jour: puisque les fichiers viennent d'être mis à jour, ils ont forcément les bonnes autorisations !</p>
<p>
On peut également lire que réparer les autorisations sur un volume externe peut être utile, lorsque les autorisations des fichiers de ce volume sont corrompues. C'est une pure aberration car, comme expliqué ci-avant, la réparation des autorisations n'est effective que sur les volumes sur lesquels Mac OS X est installé. Pas de répertoire /Library/Receipts/, pas de réparation des autorisations. Point.</p>
<table border="0" align="center">
<tr>
<td>D'ailleurs, l'utilitaire de disque de Mac OS X l'explique très bien...</td>
</tr>
<tr>
<td><img alt="Utilitaire de disque" src="http://blog.gfblog.com/images/autorisations/utildisque.png" /></td>
</tr>
</table>
<p>
Certains disent encore que la réparation des autorisations a résolu un problème avec un logiciel tierce-partie. C'est en fait peu probable. Les gros logiciels comme ceux de Microsoft, Adobe ou Macromedia n'utilisent pas Installer.app. Il est donc théoriquement impossible que la réparation des autorisations puisse résoudre un problème ne touchant qu'un seul de ces logiciels. Il est en revanche beaucoup plus probable qu'une série d'autorisations corrompues sur le système engendre des comportements étranges pour plusieurs de ces logiciels. Par exemple, si les permissions de /Library/ sont fixées à 000, tout explose...</p>
<h3>Comment résoudre les problèmes ?</h3>
<p>
Si une application crash (elle "plante"), et laisse un rapport de bug (bug report) à envoyer à Apple, vous pourrez voir les détails du rapport. Dans ce cas, faites un copier/coller du rapport dans TextEdit et lisez calmement. Vous verrez peut-être quelque chose qui vous met la puce à l'oreille. C'est ainsi que j'ai par exemple découvert que la dernière version d'<a href="http://www.unsanity.com/haxies/ape" target="_new">Application Enhancer</a> faisait planter Dreamweaver 2004. Solution express: mettre DW dans la Master Exclude List d'APE, et le problème est résolu.</p>
<p>
Vous pouvez également consulter les logs système, notamment en lisant ce que dit la Console (Applications/Utilitaires/Console). Si vous avez un problème, la Console vous en indiquera la source. A vous de trouver ensuite la solution.</p>
<p>
Si le problème vient d'un logiciel, effacez ses préférences et redémarrez-le. Réinstaller un logiciel ne sert la plupart du temps à rien car seul l'exécutable (le package) sera remplacé, et pas les préférences. Or, l'exécutable n'est, dans la majorité des cas, pas modifiable (le problème ne peut donc pas venir de lui), contrairement aux préférences (appelées "prefs") qui se corrompent facilement. Les préférences sont situées dans le répertoire <i>~/Library/Preferences/</i><i> (ou </i><i>~/Bibliothèque/Préférences/</i>), ou dans un autre emplacement, mais ont l'extension .plist. Vous pouvez faire une recherche avec Spotlight : "<i>nom-du-logiciel .plist</i>".</p>
<p>
Vous pouvez aussi supprimer les fichiers annexes créés par le logiciel. Ils sont peut être à l'origine de la corruption de ce logiciel (c'est même fréquent). Ces fichiers sont situés à l'emplacement suivant: <i>~/Library/Application Support/[Nom du logiciel]</i> (ou <i>~/Bibliothèque/...</i>).</p>
<p>
Si le problème se pose pour un logiciel qui admet des <i>plug-ins</i> ou des <i>add-ons</i>, pensez à désactiver ces <i>plug-ins</i> ou <i>add-ons</i>. Pour les logiciels Apple, ils se situent dans le répertoire <i>~/Library/[Nom du logiciel]</i><i> (ou </i><i>~/Bibliothèque/...</i>). Par exemple, pour Apple Mail, c'est <i>~/Library/Mail/Bundles</i><i>. Le logiciel peut aussi permettre de désactiver ces extensions : c'est le cas de Firefox. Vous pourrez alors identifier la source du problème sans tout désinstaller.<br />
</i></p>
<p>
Si vous avez installé un nouveau périphérique, désactivez le et désinstallez ses <i>drivers</i> (ou <i>pilotes</i>) avant de vérifier si le problème persiste. Les périphériques USB notamment sont connus pour générer des Kernel Panic sous Mac OS X (c'était particulièrement vrai dans les premières versions d'OS X, c'est un peu moins vrai maintenant, mais sait-on jamais...).</p>
<p>
Enfin, n'oubliez jamais qu'il y a un choix à faire:</p>
<ul style="list-style-type: none;">
<li />Installer des jeux, utilitaires, sharewares et freewares, dernières versions ou versions plus anciennes, les désinstaller, les manipuler, modifier les programmes existants, trifouiller les préférences... et ne pas avoir peur de formater et opérer une <em>clean install</em> quand les choses vont trop mal.
<li />Installer une bonne fois pour toutes ce dont on a besoin, et ne plus rien toucher. C'est ainsi que vous pourrez utiliser votre Mac pendant 10 ans sans jamais formater.
</ul>
<p>&lt;/p&gt;</p>
<p><i><br />
à Montpellier le 27/09/2005<br />
mis à jour à Montpellier le 29/07/2007<br />
mis à jour à Montpellier le 23/03/2010 (concernant l'article de la KB Apple et Installer.app : aucune modification de fond)<br />
</i></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Valhalla.fr</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Valhalla.fr</li>
          <li><a href="mailto:your-email@domain.com">your-email@domain.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mw4rf">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">mw4rf</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Ad Absurdum</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
