<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Synchronisation désynchronisée resynchronisée</title>
  <meta name="description" content="Quel titre étrange ! Il vaut mieux l'expliquer tout de suite : parmi les fonctionnalités proposées par le service .Mac d'Apple, la synchronisation permet de ...">
  <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  
  <!-- Twitter Bootstrap -->
  <link rel="stylesheet" href='/assets/bootswatch/yeti.min.css'>
  <!-- Font Awesome -->
  <link rel="stylesheet" href='/assets/font-awesome/css/font-awesome.min.css'>
  git
  <link rel="stylesheet" href="/css/main.css">
  
  
  <link rel="canonical" href="http://www.valhalla.fr/2008/01/12/synchronisation-desynchronisee-resynchronisee/">
  <link rel="alternate" type="application/atom+xml" title="Valhalla.fr" href="http://www.valhalla.fr/feed.xml" />
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.valhalla.fr">Valhalla.fr</a>
    </div>

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      
      <ul class="nav navbar-nav">
        
          
            <li>
            <a href="http://www.valhalla.fr/a-propos/">À Propos</a>
          
          </li>
        
          
            <li>
            <a href="http://www.valhalla.fr/revue/">Revue</a>
          
          </li>
        
          
            <li class="dropdown">
              <a href="http://www.valhalla.fr" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">Archives <i class="caret"></i></a>
              <ul class="dropdown-menu">
              
                <li><a href="http://www.valhalla.fr/articles-essentiels/">Articles essentiels</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/index.html">Archives chronologiques</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/categories.html">Catégories</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/tags.html">Tags</a></li>
              
              </ul>
          
          </li>
        
          
            <li class="dropdown">
              <a href="http://www.valhalla.fr" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">Divers <i class="caret"></i></a>
              <ul class="dropdown-menu">
              
                <li><a href="http://www.valhalla.fr/outils/">Outils</a></li>
              
                <li><a href="http://www.valhalla.fr/java/">Java</a></li>
              
                <li><a href="http://www.valhalla.fr/twitter/">Twitter</a></li>
              
              </ul>
          
          </li>
        
      </ul>
      
      <!-- Google Custom Search Engine -->
      <form action="http://www.google.com/cse" id="cse-search-box" _lpchecked="1" class="navbar-form navbar-right" role="search">
        <input type="hidden" name="cx" value="007528237610497066360:tooxybveeoo">
        <input type="hidden" name="ie" value="UTF-8">
        <input name="siteurl" type="hidden" value="http://www.valhalla.fr">
        <input name="ref" type="hidden" value="">
        <input name="ss" type="hidden" value="">
        <div class="input-group input-group-sm">
          <input type="text" class="form-control" name="q" style="background: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif) 0% 50% no-repeat rgb(255, 255, 255);">
        </div>
      </form>
      <!-- END Google Custom Search Engine -->
            
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

    <div id="page-content">
      <div class="container">
  <div class="row">
    <div class="col-md-2 col-sm-1"></div>
    <div class="col-md-8 col-sm-10 col-xs-12">
      <div class="page-header">
        <h1>
          Synchronisation désynchronisée resynchronisée
          <small>
              12 Jan 2008
              
               • 
                  
                      GF
                  
              

              
          </small>
        </h1>
      </div>
      
      <div class="text-content"><p>Quel titre étrange ! Il vaut mieux l'expliquer tout de suite : parmi les fonctionnalités proposées par le service .Mac d'Apple, la <i>synchronisation</i> permet de garder automatiquement certains éléments à jour sur plusieurs Mac simultanément. On synchronise notamment le trousseau d'accès (ou <i>keychains</i>), ensemble de données chiffrées représentant les mots de passe enregistrés sur des sites Web. Mais .Mac étant ce qu'il est, il arrive parfois que les données se <i>désynchronisent</i>. Les données sont alors différentes sur chaque Mac et sur l'iDisk. Les conséquences sont souvent fâcheuses, surtout lorsqu'on fait confiance au système de synchronisation : des enregistrements plus anciens effacent des enregistrements récents, des enregistrements supprimés reviennent comme par miracle ou pire, tout disparaît. Il faut alors <i>resynchroniser</i> le tout, ce qui est plus facile à dire qu'à faire. Cet article est le récit de deux mésaventures avec la synchronisation du trousseau 1Password et avec l'iDisk.</p>
<p><a id="more"></a><a id="more-136"></a></p>
<h2>Synchronisation du trousseau 1Password</h2>
<p>Le logiciel <a href="http://1password.com/">1Password</a> est bien connu dans le monde Mac depuis un peu plus de d'une année. Il s'agit d'un logiciel formidable, qui devient vite indispensable (généralement dans les 10 minutes qui suivent son installation...). La fonction principale du logiciel est de récupérer tous les mots de passe des pages Web et de les enregistrer dans le Trousseau de Mac OS X, pour les restituer ensuite lors des visites ultérieures. Il permet également de stocker des données importantes de manière sécurisée, telles que des codes d'activation de logiciels et de générer de manière aléatoire des mots de passe complexes (alphanumériques avec des symboles, quasiment impossibles à retenir). Depuis février 2007, j'ai accumulé exactement 415 couples <i>nom d'utilisateur / mot de passe</i> de sites Web que 1Password retient à ma place. Lorsque je me rends sur une page Web pour laquelle j'ai enregistré un mot de passe, il me suffit de taper un raccourci clavier prédéfini pour que 1Password remplisse le formulaire de connexion à ma place. Certes, Safari fait déjà cela, mais 1Password présente deux avantages fondamentaux. D'une part, il permet d'utiliser la même base de données sur plusieurs navigateurs, dont Firefox qui n'utilise normalement pas le Trousseau de Mac OS X, et dont les mots de passe ne peuvent donc pas être synchronisés par le biais de .Mac. D'autre part, il permet d'enregistrer plusieurs mots de passe différents pour un même site ; très pratique lorsqu'on a plusieurs comptes !</p>
<p>Je synchronise habituellement les trousseaux entre 3 ordinateurs, un PowerBook G4, un iMac et un MacPro. Pour une raison qui m'est inconnue, la synchronisation a subitement cessé de fonctionner il y a quelques temps. Les données ne se mettaient plus à jour, elles ne fusionnaient plus. Si j'ajoutais un mot de passe A sur le PowerBook et un mot de passe B sur l'iMac, le mot de passe A n'était pas transmis à l'iMac et le mot de passe B n'était pas transmis au PowerBook. Le problème ne se présentait cependant qu'avec le trousseau 1Password : le trousseau "session" (qui contient les mots de passe enregistrés par Safari) n'était pas affecté.</p>
<p>J'ai essayé une première manipulation pour résoudre le problème : réinitialiser les données de synchronisation avec la version la plus à jour. Je suis donc allé dans les <b>Préférences systèmes</b> du <b>menu Pomme</b> du Mac à jour, section <b>.Mac</b>, onglet <b>Synchronisation</b>. J'ai ensuite cliqué sur le bouton <b>Avancé</b> puis sur le bouton <b>Réinitialiser les données de synchronisation</b>. J'ai indiqué que je voulais que la synchronisation aille dans le sens Ordinateur =&gt; .Mac et j'ai confirmé que je voulais remplacer toutes les données de .Mac par celles de l'ordinateur. Une fois la synchronisation terminée (sans erreur), j'ai refait la même chose sur un autre Mac, dont les trousseaux n'étaient pas à jour, en choisissant cette fois d'écrire les données dans l'autre sens, c'est-à-dire en remplaçant les données de l'ordinateur par celles de .Mac. Cela n'a absolument rien donné. J'ai retrouvé dans le trousseau 1Password exactement les mêmes données qu'avant, les mêmes différences entre le premier Mac et le second...</p>
<p>J'ai alors essayé une autre procédure, drastique. J'ai remplace le trousseau 1Password du Mac non à jour par celui du Mac à jour. Pour ce faire, j'ai choisi <b>Backup Keychains</b> dans le menu <b>File</b> de 1Password du Mac à jour. Cela a créé un fichier de sauvegarde du trousseau et ouvert une fenêtre du Finder à l'emplacement de ce fichier. J'ai transféré le fichier sur le Mac non à jour à l'emplacement idoine (<i>~/Keychains/Backups</i>), puis j'ai choisi de restaurer la sauvegarde dans 1Password en passant par le menu <b>File</b>, <b>Restore Keychain from Backup</b>. J'ai alors obtenu une version à jour de mon trousseau. Cela n'a pas duré. J'ai désenchanté à la première modification du trousseau sur l'un ou l'autre des ordinateurs. La synchronisation persistait à ne pas s'opérer ; les données étaient véritablement désynchronisées.</p>
<p>J'ai alors fouillé un peu sur le Web, notamment sur les forums de 1Password. Une des méthodes préconisées consiste à réinitialiser non seulement les données de synchronisation (première manipulation décrite ci-dessus), mais à réinitialiser en outre les enregistrements des appareils à synchroniser. Autrement dit, faire en sorte que .Mac croit que chaque Mac opère la première synchronisation de son histoire. Il s'agit d'un remise à plat totale. Il faut se rendre dans les <b>Préférences systèmes</b> du <b>menu Pomme</b>, section <b>.Mac</b>, onglet <b>Synchronisation</b> et cliquer sur le bouton <b>Avancé</b>. Jusque là, rien de nouveau. La nouveauté apparaît maintenant : il faut sélectionner une entrée dans la liste des appareils synchronisés et cliquer sur le bouton <b>Annuler l'enregistrement</b>, puis répéter la même procédure pour chacune des autres entrées de la liste. Il n'est pas nécessaire  faire cela sur chaque ordinateur synchronisé, il suffit d'effacer les entrées correspondant à chaque ordinateur depuis n'importe lequel d'entre eux (est-ce clair ?). Une fois tous les ordinateurs rayés de la liste, une petite fenêtre apparaît et demande si l'on veut effacer les données de synchronisation de l'iDisk, celles-ci étant devenues inutiles. Il faut bien entendu accepter la proposition. Une fois fait, on doit re-cocher la case <b>Synchroniser avec .Mac</b> dans l'onglet <b>Synchronisation</b> de la section <b>.Mac</b> des <b>Préférences système</b> d'un Mac à jour, puis toutes les cases des différents éléments à synchroniser (contacts, signets, widgets, calendriers, <i>trousseaux</i>, etc). La sauvegarde des données sur .Mac est donc toute fraîche après synchronisation. Il ne restera plus qu'à synchroniser les autres ordinateurs en choisissant de remplacer toutes les données de l'ordinateur par celles de .Mac.</p>
<p>En théorie, cela doit fonctionner. En pratique, cela n'a pas fonctionné (sic). En effet, mon trousseau 1Password a été complètement vidé sur mon PowerBook, alors qu'il restait indemne sur mon MacPro. Malgré plusieurs synchronisation forcées, le PowerBook refusait de prendre en compte le trousseau 1Password lors de la synchronisation. Et, bien entendu, aucun message d'erreur n'apparaissait. Tout se passait très bien, sauf qu'en réalité rien ne se passait.</p>
<p>Las, je suis allé consulter la <a href="http://docs.info.apple.com/article.html?artnum=305146#2">Kbase</a> d'Apple (base de connaissances sur les technologies mises en oeuvre sur Mac). J'ai trouvé cet article très intéressant sur le Trousseau d'accès qui suggère de le vérifier et, le cas échéant, de le réparer. C'est ce que j'ai décidé de faire. J'ai ouvert le <b>Trousseau d'accès</b> qui se trouve dans <b>Applications/Utilitaires</b> et j'ai choisi <b>S.O.S. Trousseau</b> dans le menu <b>Trousseau d'accès</b>. J'ai ensuite rentré mon mot de passe administrateur et j'ai cliqué sur <b>Réparer</b>. Horreur, il y avait des erreurs ! Bonheur, elles furent réparées !</p>
<p>Après cette petite réparation, je me suis dit que j'allais une fois de plus tout remettre à plat. J'ai donc refait pour la nième fois la procédère décrite ci-dessus de réinitialisation des données de synchronisation. Cela n'a rien donné. Mais je me suis rendu compte que la case <b>Synchronise this keychain with .Mac</b> des préférences de 1Password était décochée (menu <b>1Password</b>, <b>Preferences</b>, section <b>Keychain</b>, bouton <b>Edit keychain settings...</b>). Je l'ai cochée et j'ai redémarré 1Password. Le logiciel a recréé le trousseau 1Password dans le Trousseau d'accès (je suppose que ce trousseau avait été détruit par ma précédente synchronisation "à vide", sans en être sûr). Ce trousseau régénéré était totalement vide. J'ai alors lancé une dernière synchronisation .Mac qui fut --enfin-- couronnée de succès. J'avais finalement toutes mes données à jour...</p>
<p>La synchronisation est censée faire gagner du temps, en évitant d'avoir à transférer manuellement des fichiers, mais il est évident qu'elle peut également en faire perdre beaucoup, les données ayant tendance à être corrompues pour je ne sais quelles raisons. A relativiser tout de même : je n'avais jamais eu de tel problème en un an d'utilisation de 1Password. Cela doit être l'<i>effet Leopard</i>...</p>
<h2>Synchronisation des paquets</h2>
<p>Puisque cet article a pour sujet la synchronisation, je ne pouvais éviter de parler du problème de la synchronisation des <b><i>paquets</i></b>. </p>
<p>On connaît depuis longtemps les <i>dossiers</i> ou <i>répertoires</i> qui sont à la base de tout système de fichiers et qui contiennent des fichiers. Mac Os X a introduit une nouveauté : les paquets. Ceux-ci sont des dossiers qui apparaissent comme des fichiers. Autrement dit, l'utilisateur a l'impression qu'il ne s'agit que d'un seul fichier, alors qu'il s'agit en fait d'un dossier contenant une multitude de fichiers. C'est par exemple le cas des fichiers OpenXML (à l'extension .docx) générés par Microsoft Word. C'est aussi le cas, sur Mac, de nombreux fichiers créés par divers logiciels comme <a href="http://www.valhalla.fr/index.php/2006/11/20/devonthink-organise-la-pensee/">DevonThink</a> ou Scrivener ou, plus généralement, de l'immense majorité des logiciels. Pour s'en persuader, on peut faire un <b>clic-droit</b> sur n'importe quel logiciel du dossier Application et choisir, dans le menu déroulant qui apparaît, l'option <b>Afficher le contenu du paquet</b>.</p>
<p>Depuis très longtemps, sur tous les systèmes (Mac, Windows, Linux), lorsqu'on copie un fichier à un emplacement où il existe déjà, le système demande si l'on veut annuler l'opération ou remplacer l'ancien fichier par le nouveau. Le problème est qu'il en va de même avec les dossiers. De cette manière, si l'on choisit de remplacer, l'entier contenu de l'ancien dossier sera remplacé par celui du nouveau dossier, <i>même ce qui n'avait pas changé</i>. En d'autres termes, il s'agit d'un écrasement ou d'un remplacement intégral, et non d'une synchronisation. C'est extrêmement problématique lorsqu'on doit synchroniser une ou plusieurs fois par jour un paquet de plusieurs Go par Internet. Cela prend des heures, tout simplement parce que ce paquet es traité comme un dossier, alors que si le système était assez intelligent pour proposer une synchronisation, seuls les fichiers modifiés seraient transmis ! Ainsi, ma base de données DevonThink ne mettrait pas 3 heures par jour à se synchroniser, mais plutôt 30 secondes, puisque seulement une petite partie des fichiers ont été modifiés.</p>
<p>Certains logiciels de sauvegarde ou de synchronisation présentent le même défaut. Ils comparent en effet les emplacements à synchroniser à partir de la date de la dernière modification des fichiers. Or, si les paquets sont traités comme des fichiers, la moindre modification d'un fichier du paquet comptera pour une modification du paquet entier ! Le paquet de 3 Go devra être recopié intégralement, même si un seul fichier de 3 Ko a été ajouté ! Le problème peut être facilement résolu en utilisant un logiciel de synchronisation qui permet de <i>synchroniser les fichiers en traitant les paquets comme des dossiers</i>. Ces logiciels intelligents considèrent que les paquets sont des dossiers et qu'il ne faut modifier, à l'intérieur de ces dossiers, que les fichiers qui ont réellement été mis à jour. J'utilise le logiciel <a href="http://www.econtechnologies.com/">ChronoSync</a>, particulièrement intelligent et efficace, qui me permet de synchroniser en un rien de temps les seuls fichiers modifiés depuis la dernière synchronisation.</p>
<p>Malheureusement, Apple a jusqu'à présent choisir d'ignorer le problème. La synchronisation automatique de l'iDisk considère que la moindre modification à l'intérieur d'un paquet équivaut à la modification du paquet en son entier. Vu la lenteur des transferts sur l'iDisk avec le Finder, il est impossible de maintenir à jour une base de données de plus de quelques Mo. Peut être cela fera-t-il partie des bonnes résolution d'Apple pour 2018...</p>
</div>
      
      <hr>
      
      <div class="related">
        <h2>Voir aussi</h2>
        <ul style="list-style-type: none;">
        
            <li><a href="/2015/07/01/jekyll-hierarchie-de-dossiers/">Jekyll: une hiérarchie de dossiers</a></li>
        
            <li><a href="/2015/06/30/partitions-rebelles/">Partitions rebelles (à propos de Bootcamp)</a></li>
        
            <li><a href="/revue/numero-114/">Numéro 115 - Semaines du 23 mars au 5 avril 2015</a></li>
        
            <li><a href="/revue/numero-114/">Numéro 114 - Semaines du 9 au 22 mars 2015</a></li>
        
            <li><a href="/revue/numero-113/">Numéro 113 - Semaine du 23 février au 8 mars 2015</a></li>
        
            <li><a href="/revue/numero-112/">Numéro 112 - Semaine du 16 au 22 février 2015</a></li>
        
            <li><a href="/revue/numero-111/">Numéro 111 - Semaine du 8 au 15 février 2015</a></li>
        
            <li><a href="/revue/numero-110/">Numéro 110 - Semaines du 26 janvier au 8 février 2015</a></li>
        
            <li><a href="/revue/numero-109/">Numéro 109 - Semaine du 19 au 25 janvier 2015</a></li>
        
            <li><a href="/revue/numero-108/">Numéro 108 - Semaine du 12 au 18 janvier 2015</a></li>
        
        </ul>
      </div>
      
      
      <hr>
      <div class="comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'valhallafr';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
      </div>
      
      
    </div>
    <div class="col-md-2 col-sm-1">
  </div>
</div>

    </div>

    <div class="container-fluid" id="footer">
  <div class="row">
    
    <div class="col-md-4 col-sm-6">
      <ul class="no-bullet">
        <li>Valhalla.fr</li>
        <li>Ad Absurdum</li>
        <li><small>Tous droits réservés, sauf mention contraire.</small></li>
        <li><small>Mis à jour le  4 Jul 2015 à 16h31.</small></li>
      </ul>
    </div>
    
    <div class="col-md-4 col-sm-6">
      <a href="mailto:your-email@domain.com" id="gh" target="_blank" title="Contact">
        <span class="fa-stack fa-lg">
          <i class="fa fa-at fa-stack-1x"></i>
        </span>
        your-email@domain.com
      </a>
      <br>
      <a href="http://www.valhalla.fr/feed.xml" id="gh" target="_blank" title="RSS">
        <span class="fa-stack fa-lg">
          <i class="fa fa-rss-square fa-stack-1x"></i>
        </span>
        RSS
        </a>
    </div>
    
    <div class="col-md-4 col-sm-6">
      
      <a href="https://twitter.com/jekyllrb" id="gh" target="_blank" title="Twitter">
        <span class="fa-stack fa-lg">
          <i class="fa fa-twitter fa-stack-1x"></i>
        </span>
        Twitter
      </a>
      
      
      <br>
      <a href="https://github.com/mw4rf"  target="_blank" title="GitHub">
        <span class="fa-stack fa-lg">
          <i class="fa fa-github fa-stack-1x"></i>
        </span>
        GitHub
      </a>
      
    </div>
    
  </div>
</div>

    <script src="/assets/jquery.min.js" type="text/javascript" charset="utf-8"></script>

<script src="/assets/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2290016-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/masonry.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	// Initialize Masonry
	$('.grid').masonry({
		itemSelector: '.grid-item',
		columnWidth: '.grid-item',
		gutter: parseInt($('.grid-item').css('marginBottom'))
	});
</script>

  </body>

</html>
