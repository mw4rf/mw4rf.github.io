<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>Statut d'un RAID logiciel par e-mail</title>
  <meta name="description" content="La meilleure solution pour assurer la sécurité de ses données numériques reste à ce jour l'utilisation de plusieurs disques en RAID 1 "miroir". Lorsque deux ...">
  <link href="/public/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  
  <!-- Twitter Bootstrap -->
  <link rel="stylesheet" href='/assets/bootswatch/yeti.min.css'>
  <!-- Font Awesome -->
  <link rel="stylesheet" href='/assets/font-awesome/css/font-awesome.min.css'>
  git
  <link rel="stylesheet" href="/css/main.css">
  
  
  <link rel="canonical" href="http://www.valhalla.fr/2008/08/31/statut-raid-mail/">
  <link rel="alternate" type="application/atom+xml" title="Valhalla.fr" href="http://www.valhalla.fr/feed.xml" />
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.valhalla.fr">Valhalla.fr</a>
    </div>

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      
      <ul class="nav navbar-nav">
        
          
            <li>
            <a href="http://www.valhalla.fr/a-propos/">À Propos</a>
          
          </li>
        
          
            <li>
            <a href="http://www.valhalla.fr/revue/">Revue</a>
          
          </li>
        
          
            <li class="dropdown">
              <a href="http://www.valhalla.fr" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">Archives <i class="caret"></i></a>
              <ul class="dropdown-menu">
              
                <li><a href="http://www.valhalla.fr/articles-essentiels/">Articles essentiels</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/index.html">Archives chronologiques</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/categories.html">Catégories</a></li>
              
                <li><a href="http://www.valhalla.fr/archives/tags.html">Tags</a></li>
              
              </ul>
          
          </li>
        
          
            <li class="dropdown">
              <a href="http://www.valhalla.fr" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">Divers <i class="caret"></i></a>
              <ul class="dropdown-menu">
              
                <li><a href="http://www.valhalla.fr/outils/">Outils</a></li>
              
                <li><a href="http://www.valhalla.fr/java/">Java</a></li>
              
                <li><a href="http://www.valhalla.fr/twitter/">Twitter</a></li>
              
              </ul>
          
          </li>
        
      </ul>
      
      <!-- Google Custom Search Engine -->
      <form action="http://www.google.com/cse" id="cse-search-box" _lpchecked="1" class="navbar-form navbar-right" role="search">
        <input type="hidden" name="cx" value="007528237610497066360:tooxybveeoo">
        <input type="hidden" name="ie" value="UTF-8">
        <input name="siteurl" type="hidden" value="http://www.valhalla.fr">
        <input name="ref" type="hidden" value="">
        <input name="ss" type="hidden" value="">
        <div class="input-group input-group-sm">
          <input type="text" class="form-control" name="q" style="background: url(http://www.google.com/cse/intl/en/images/google_custom_search_watermark.gif) 0% 50% no-repeat rgb(255, 255, 255);">
        </div>
      </form>
      <!-- END Google Custom Search Engine -->
            
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

    <div id="page-content">
      <div class="container">
  <div class="row">
    <div class="col-md-2 col-sm-1"></div>
    <div class="col-md-8 col-sm-10 col-xs-12">
      <div class="page-header">
        <h1>
          Statut d'un RAID logiciel par e-mail
          <small>
              31 Aug 2008
              
               • 
                  
                      GF
                  
              

              
          </small>
        </h1>
      </div>
      
      <div class="text-content"><p>La meilleure solution pour assurer la sécurité de ses données numériques reste à ce jour l'utilisation de plusieurs disques en RAID 1 "miroir". Lorsque deux disques durs sont montés en RAID 1, chaque fichier copié sur un disque l'est aussi automatiquement sur l'autre. La copie est transparente pour l'utilisateur, qui ne voit qu'un seul volume logiciel de la taille d'un seul disque. Si l'un des deux disques devient inutilisable, les données peuvent toujours être récupérées depuis le second disque. Un tel montage est efficace contre les pannes matérielles qui affectent habituellement les disques durs. Mais encore faut-il vérifier régulièrement l'état du Raid. En effet, si un disque tombe en panne, l'autre disque prendra immédiatement le relai sans que l'utilisateur s'en aperçoive. Celui-ci pourra encore croire en l'intégrité du Raid, alors qu'un seul disque reste fonctionnel. Il est donc nécessaire d'obtenir des informations sur l'état du Raid, par exemple par e-mail. </p>
<p><a id="more"></a><a id="more-140"></a></p>
<p>La première chose à faire est de créer un RAID logiciel. Il faut bien entendu deux disques durs de taille identique (internes ou externes ; mieux vaut internes).</p>
<p>L'utilitaire de disques de Mac OS X, se trouvant dans <i>Applications/Utilitaires/</i> permet de créer des Raid 1 logiciels. Une fois les deux disques reconnus par l'utilitaire de disque, il suffit de créer un <u>Ensemble RAID en miroir</u>. Attention, les disques seront alors formatés...</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713505/" title="Raid1 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3287/2812713505_07ae545e56.jpg" width="500" height="412" alt="Raid1" /></a></p>
<p>Une fois le raid monté, il est bien sûr possible de revenir dans l'utilitaire de disques pour en vérifier l'intégrité. Mais il est aussi facile d'oublier de le faire...</p>
<p>Nous utiliserons donc une commande du terminal, qui informe sur l'état du raid, et nous enverrons le résultat de cette commande par e-mail grâce à un script automator lancé de manière récurrente par iCal.</p>
<p>La commande de terminal en question est <b>diskutil checkraid</b>.</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713503/" title="raid2 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3064/2812713503_ee3dbb048a_o.jpg" width="585" height="297" alt="raid2" /></a></p>
<p>La seule chose vraiment importance dans tout ce texte, c'est la colonne "Status" qui, pour les deux disques, indique "Online". Voilà ce qu'il faut vérifier périodiquement : que tous les disques sont "online", c'est-à-dire en bon état de marche.</p>
<p>L'idée est donc ici d'obtenir le résultat de la dommande diskutil checkraid pour l'insérer dans un e-mail qui sera envoyé de manière récurrente.</p>
<p>Le script que j'utilise fonctionne ainsi :</p>
<ol>
<li /><u>Créer un fichier texte</u> à un endroit précis du disque (p. ex. ~/Documents/). Cocher la case <i>Remplacer les fichiers présents</i> pour éviter que le script échoue si le fichier existe déjà à cet emplacement. Donner au fichier un nom évocateur, p. ex. CHECKRAID.txt
<li /><u>Exécuter un script Shell</u> : diskutil checkraid
<li />(Optionnel) <u>Afficher les résultats</u> : cette action ne sert qu'à voir, dans Automator, ce que renvoie le script Shell précédent. Elle peut être supprimée sans incidence sur la suite.
<li /><u>Définir le contenu du document TextEdit</u> : le message renvoyé par le script Shell sera inséré dans le fichier texte créé à la première étape. Option : <i>Remplacement</i> pour être sûr que, s'il y a déjà du texte dans le fichier, celui-ci soit effacé et remplacé par le résultat du script Shell (en principe, si la case Remplacer... est cochée à l'étape 1, ceci est superflu).
<li /><u>Nouveau message mail</u>, en indiquant bien entendu le destinataire (votre e-mail), le compte de l'expéditeur (il faut avoir paramétré Apple Mail auparavant) et l'objet. On peut insérer des variables dans l'objet, par exemple la date et l'heure d'exécution de notre script. Le contenu du fichier texte sera inséré dans le corps de l'e-mail.
<li /><u>Envoyer les messages de la boîte d'envoi</u> pour que l'e-mail soit envoyé immédiatement.
<li />(Optionnel) <u>Obtenir les éléments du Finder indiqués</u>, choisir le fichier créé à l'étape 1, puis <u>Placer des éléments du Finder dans la corbeille</u> pour faire le ménage après l'exécution du script.
</ol>
<p>Voici le résultat dans Automator :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812702007/" title="Image 5 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3037/2812702007_95286ce199_o.png" width="712" height="621" alt="Image 5" /></a><br />
<a href="http://www.flickr.com/photos/valhallafr/2812768863/" title="raid6 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3198/2812768863_3ff4b8b5e6_o.jpg" width="707" height="652" alt="raid6" /></a></p>
<p>Reste ensuite à enregistrer notre script. Dans Automator, on ira dans le menu Fichier &gt; Enregistrer sous. On fera cela deux fois, en choisissant dans le menu déroulant <i>Processus</i> et <i>Application</i>. Cela donnera deux fichiers :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812702015/" title="Image 4 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3146/2812702015_00a5eb5d1b_o.png" width="277" height="86" alt="Image 4" /></a></p>
<p>Le premier est l'application, que nous utiliserons par la suite. Le second est le fichier que l'on ouvre dans Automator pour modifier le script.</p>
<p>Reste à lancer <b>iCal</b> et à créer un nouvel événement récurrent :</p>
<p><a href="http://www.flickr.com/photos/valhallafr/2812713495/" title="raid3 de GF @ valhalla.fr, sur Flickr"><img src="http://farm4.static.flickr.com/3087/2812713495_dc473cca7d_o.jpg" width="297" height="410" alt="raid3" /></a></p>
<p>On choisira l'action <i>Ouvrir le fichier</i> et on sélectionnera le fichier d'application créé à l'étape précédente. On définira ensuite la périodicité de cet événement.</p>
<p>NB : le lancement de l'application par iCal étant la manifestation d'une alarme, programmée X minutes avant le début de l'événement, il faudra faire débuter l'événement à H+X minutes pour que l'e-mail soit envoyé à l'heure H voulue. Sur l'image précédente, événement à 12h15, rappel 15 minutes avant le début, e-mail envoyé à 12h00.</p>
<p>C'est tout !</p>
<p>Vous pouvez télécharger le script pour Automator (Leopard) et le modifier à votre guise : <a href="/public/posts/2008-08-31-checkraid/checkraid.zip">CheckRaid</a></p>
</div>
      
      <hr>
      
      <div class="related">
        <h2>Voir aussi</h2>
        <ul style="list-style-type: none;">
        
            <li><a href="/2015/07/01/jekyll-hierarchie-de-dossiers/">Jekyll: une hiérarchie de dossiers</a></li>
        
            <li><a href="/2015/06/30/partitions-rebelles/">Partitions rebelles (à propos de Bootcamp)</a></li>
        
            <li><a href="/revue/numero-114/">Numéro 115 - Semaines du 23 mars au 5 avril 2015</a></li>
        
            <li><a href="/revue/numero-114/">Numéro 114 - Semaines du 9 au 22 mars 2015</a></li>
        
            <li><a href="/revue/numero-113/">Numéro 113 - Semaine du 23 février au 8 mars 2015</a></li>
        
            <li><a href="/revue/numero-112/">Numéro 112 - Semaine du 16 au 22 février 2015</a></li>
        
            <li><a href="/revue/numero-111/">Numéro 111 - Semaine du 8 au 15 février 2015</a></li>
        
            <li><a href="/revue/numero-110/">Numéro 110 - Semaines du 26 janvier au 8 février 2015</a></li>
        
            <li><a href="/revue/numero-109/">Numéro 109 - Semaine du 19 au 25 janvier 2015</a></li>
        
            <li><a href="/revue/numero-108/">Numéro 108 - Semaine du 12 au 18 janvier 2015</a></li>
        
        </ul>
      </div>
      
      
      <hr>
      <div class="comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'valhallafr';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
      </div>
      
      
    </div>
    <div class="col-md-2 col-sm-1">
  </div>
</div>

    </div>

    <div class="container-fluid" id="footer">
  <div class="row">
    
    <div class="col-md-4 col-sm-6">
      <ul class="no-bullet">
        <li>Valhalla.fr</li>
        <li>Ad Absurdum</li>
        <li><small>Tous droits réservés, sauf mention contraire.</small></li>
        <li><small>Mis à jour le  2 Jul 2015 à 22h38.</small></li>
      </ul>
    </div>
    
    <div class="col-md-4 col-sm-6">
      <a href="mailto:your-email@domain.com" id="gh" target="_blank" title="Contact">
        <span class="fa-stack fa-lg">
          <i class="fa fa-at fa-stack-1x"></i>
        </span>
        your-email@domain.com
      </a>
      <br>
      <a href="http://www.valhalla.fr/feed.xml" id="gh" target="_blank" title="RSS">
        <span class="fa-stack fa-lg">
          <i class="fa fa-rss-square fa-stack-1x"></i>
        </span>
        RSS
        </a>
    </div>
    
    <div class="col-md-4 col-sm-6">
      
      <a href="https://twitter.com/jekyllrb" id="gh" target="_blank" title="Twitter">
        <span class="fa-stack fa-lg">
          <i class="fa fa-twitter fa-stack-1x"></i>
        </span>
        Twitter
      </a>
      
      
      <br>
      <a href="https://github.com/mw4rf"  target="_blank" title="GitHub">
        <span class="fa-stack fa-lg">
          <i class="fa fa-github fa-stack-1x"></i>
        </span>
        GitHub
      </a>
      
    </div>
    
  </div>
</div>

      <script src="/assets/jquery.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/assets/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2290016-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>

</html>
